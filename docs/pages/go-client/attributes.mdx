# Attributes

Attributes attach contextual tags to exceptions and transactions, making it easier to debug and filter issues in the dashboard.

## Request Attributes

Add contextual information specific to a single request:

```go
import tracewaygin "github.com/tracewayapp/go-client/traceway_gin"

func handler(c *gin.Context) {
    attributes := tracewaygin.GetAttributesFromGin(c)

    // Add tags that will be attached to any exceptions in this request
    attributes.SetTag("user_id", c.Param("id"))
    attributes.SetTag("tenant", "acme-corp")
    attributes.SetTag("feature_flag", "new_checkout")

    // ... rest of handler
}
```

Request attribute tags are automatically included when:

- Exceptions are captured during the request
- The transaction is recorded
- Segments are tracked

## Attributes Methods

| Method                              | Description                                    |
| ----------------------------------- | ---------------------------------------------- |
| `SetTag(key, value string)`         | Set a string tag                               |
| `SetTagJson(key string, value any)` | Set a JSON-serialized tag (for complex values) |
| `GetTag(key string)`                | Retrieve a tag value                           |
| `GetTags()`                         | Get a copy of all tags                         |

### Examples

```go
// String tags
attributes.SetTag("user_id", "12345")
attributes.SetTag("organization", "acme-corp")

// JSON tags for complex values
attributes.SetTagJson("cart_items", []string{"item1", "item2", "item3"})
attributes.SetTagJson("user_prefs", map[string]bool{"notifications": true})

// Reading tags
userID := attributes.GetTag("user_id")
allTags := attributes.GetTags()
```

## Attributes in Middleware

Add tags for all requests in a middleware function:

```go
func authMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        user := authenticate(c)

        // Add user info to attributes for all downstream handlers
        attributes := tracewaygin.GetAttributesFromGin(c)
        attributes.SetTag("user_id", user.ID)
        attributes.SetTag("user_email", user.Email)
        attributes.SetTag("organization", user.OrgID)
        attributes.SetTag("role", user.Role)

        c.Next()
    }
}
```

## Global Attributes

Global attribute tags apply to all telemetry data. Configure them once at application startup:

```go
import "github.com/tracewayapp/go-client/traceway"

func main() {
    // Configure global attributes (runs once at startup)
    traceway.ConfigureAttributes(func(s *traceway.Attributes) {
        s.SetTag("environment", "production")
        s.SetTag("region", "us-east-1")
        s.SetTag("service", "user-api")
        s.SetTag("version", os.Getenv("APP_VERSION"))
    })

    // ... rest of your application
}
```

Global tags are inherited by every request's attributes and background task.

## Tag Inheritance

Tags flow from global to request attributes:

```
Global Attributes          Request Attributes         Final Tags
─────────────────          ──────────────────         ──────────
environment: prod     +    user_id: 123         =    environment: prod
region: us-east-1          tenant: acme               region: us-east-1
service: user-api                                     service: user-api
                                                      user_id: 123
                                                      tenant: acme
```

Request-level tags override global tags if they have the same key.

## Best Practices

### 1. Set Global Context at Startup

```go
traceway.ConfigureAttributes(func(s *traceway.Attributes) {
    s.SetTag("environment", os.Getenv("ENV"))
    s.SetTag("version", version)
    s.SetTag("region", os.Getenv("AWS_REGION"))
    s.SetTag("service", serviceName)
})
```

### 2. Add User Context in Auth Middleware

```go
func authMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        if user := getCurrentUser(c); user != nil {
            attributes := tracewaygin.GetAttributesFromGin(c)
            attributes.SetTag("user_id", user.ID)
            attributes.SetTag("organization", user.OrgID)
        }
        c.Next()
    }
}
```

### 3. Add Request-Specific Context in Handlers

```go
func createOrderHandler(c *gin.Context) {
    attributes := tracewaygin.GetAttributesFromGin(c)
    attributes.SetTag("action", "create_order")
    attributes.SetTag("item_count", fmt.Sprintf("%d", len(items)))
    // ... rest of handler
}
```

### 4. Use Meaningful Tag Names

```go
// Good - descriptive and searchable
attributes.SetTag("user_id", userID)
attributes.SetTag("order_id", orderID)
attributes.SetTag("payment_method", "stripe")

// Avoid - too generic
attributes.SetTag("id", someID)
attributes.SetTag("type", "thing")
```

## Viewing Tags in Dashboard

Tags appear in the detail view for:

1. **Exceptions** and **Messages**
2. **Endpoints**
3. **Tasks**

Use tags to debug issues with full context
